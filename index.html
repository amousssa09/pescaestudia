<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé£ Pesca de Conocimiento</title>
    <style>
        /* ==================== ESTILOS GENERALES ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #2c3e50;
            color: #ecf0f1;
            overflow-x: hidden;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* Paleta de colores retro */
        :root {
            --color-primary: #3498db;
            --color-success: #2ecc71;
            --color-danger: #e74c3c;
            --color-warning: #f39c12;
            --color-dark: #1a252f;
            --color-light: #ecf0f1;
            --color-ocean: #006994;
            --color-sand: #f4d03f;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ==================== BOTONES RETRO ==================== */
        .btn {
            padding: 12px 24px;
            border: 4px solid #000;
            background: var(--color-primary);
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 4px 4px 0 #000;
            transition: all 0.1s;
            margin: 5px;
        }

        .btn:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 #000;
        }

        .btn:active {
            transform: translate(4px, 4px);
            box-shadow: 0 0 0 #000;
        }

        .btn-success { background: var(--color-success); }
        .btn-danger { background: var(--color-danger); }
        .btn-warning { background: var(--color-warning); }
        .btn-small { padding: 8px 16px; font-size: 14px; }

        /* ==================== PANTALLAS ==================== */
        .screen {
            display: none;
            animation: fadeIn 0.3s;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ==================== MEN√ö PRINCIPAL ==================== */
        .main-menu {
            text-align: center;
            padding: 50px 20px;
        }

        .game-title {
            font-size: 48px;
            color: var(--color-warning);
            text-shadow: 4px 4px 0 #000;
            margin-bottom: 10px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .menu-buttons {
            margin-top: 50px;
        }

        /* ==================== √ÅREA DE JUEGO ==================== */
        .game-area {
            background: linear-gradient(to bottom, #87ceeb 0%, #006994 100%);
            min-height: 500px;
            border: 8px solid #000;
            position: relative;
            overflow: hidden;
        }

        .game-header {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid #000;
        }

        .player-stats {
            display: flex;
            gap: 20px;
            font-size: 18px;
            font-weight: bold;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Canvas de pesca */
        .fishing-canvas {
            width: 100%;
            height: 400px;
            position: relative;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><rect fill="%23006994" width="100" height="100"/><circle cx="20" cy="20" r="2" fill="%2387ceeb" opacity="0.3"/><circle cx="60" cy="50" r="3" fill="%2387ceeb" opacity="0.2"/><circle cx="80" cy="80" r="2" fill="%2387ceeb" opacity="0.3"/></svg>');
        }

        .fishing-rod {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 200px;
            transition: all 0.3s;
        }

        .hook {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 40px;
            animation: float 2s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-20px); }
        }

        /* ==================== MODAL DE PREGUNTAS ==================== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--color-dark);
            border: 8px solid #000;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            box-shadow: 8px 8px 0 rgba(0, 0, 0, 0.5);
        }

        .question-text {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--color-warning);
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-btn {
            width: 100%;
            text-align: left;
            padding: 15px;
            background: #34495e;
            border: 4px solid #000;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }

        .option-btn:hover {
            background: #2c3e50;
        }

        .option-btn.correct {
            background: var(--color-success);
            animation: pulse 0.5s;
        }

        .option-btn.incorrect {
            background: var(--color-danger);
            animation: shake 0.5s;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* ==================== PANEL DE BOTS ==================== */
        .bots-panel {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            margin-top: 20px;
            border: 4px solid #000;
        }

        .bot-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            margin-bottom: 5px;
            border: 2px solid #000;
        }

        /* ==================== GESTI√ìN DE TEMARIOS ==================== */
        .temarios-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .temario-card {
            background: #34495e;
            border: 4px solid #000;
            padding: 20px;
            box-shadow: 4px 4px 0 #000;
        }

        .temario-card h3 {
            color: var(--color-warning);
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 4px solid #000;
            background: #2c3e50;
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* ==================== RESULTADO DE PESCA ==================== */
        .catch-result {
            text-align: center;
            padding: 20px;
        }

        .fish-sprite {
            font-size: 80px;
            animation: fishJump 0.5s;
        }

        @keyframes fishJump {
            0% { transform: translateY(100px) scale(0); }
            50% { transform: translateY(-20px) scale(1.2); }
            100% { transform: translateY(0) scale(1); }
        }

        .chest-sprite {
            font-size: 80px;
            animation: chestOpen 0.5s;
        }

        @keyframes chestOpen {
            0% { transform: scale(0) rotate(0deg); }
            50% { transform: scale(1.2) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        /* ==================== CONFIGURACI√ìN DE PARTIDA ==================== */
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .config-section {
            background: #34495e;
            padding: 20px;
            border: 4px solid #000;
        }

        /* ==================== ESTAD√çSTICAS ==================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: #34495e;
            padding: 20px;
            border: 4px solid #000;
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            color: var(--color-warning);
            font-weight: bold;
        }

        .stat-label {
            font-size: 14px;
            margin-top: 5px;
        }

        /* ==================== LOGROS ==================== */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .achievement {
            background: #34495e;
            border: 4px solid #000;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
        }

        .achievement.unlocked {
            background: var(--color-success);
            animation: unlockAchievement 0.5s;
        }

        @keyframes unlockAchievement {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .achievement-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .game-title {
                font-size: 32px;
            }

            .modal-content {
                padding: 20px;
            }

            .question-text {
                font-size: 16px;
            }
        }

        /* ==================== NOTIFICACIONES ==================== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--color-success);
            border: 4px solid #000;
            box-shadow: 4px 4px 0 #000;
            z-index: 2000;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        /* ==================== RANKING ==================== */
        .ranking-table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        .ranking-table th,
        .ranking-table td {
            padding: 15px;
            text-align: left;
            border: 2px solid #000;
        }

        .ranking-table th {
            background: var(--color-warning);
            color: #000;
        }

        .ranking-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.1);
        }

        .ranking-table .rank-1 {
            background: gold;
            color: #000;
        }

        .ranking-table .rank-2 {
            background: silver;
            color: #000;
        }

        .ranking-table .rank-3 {
            background: #cd7f32;
            color: #000;
        }
    </style>
</head>
<body>
    <!-- ==================== MEN√ö PRINCIPAL ==================== -->
    <div id="mainMenu" class="screen active">
        <div class="container main-menu">
            <h1 class="game-title">üé£ PESCA DE CONOCIMIENTO</h1>
            <p style="font-size: 18px; margin-top: 20px;">¬°Aprende pescando! Responde preguntas y captura peces valiosos</p>
            <div class="menu-buttons">
                <button class="btn btn-success" onclick="showScreen('gameConfig')">üéÆ JUGAR</button>
                <button class="btn btn-warning" onclick="showScreen('temariosScreen')">üìö GESTIONAR TEMARIOS</button>
                <button class="btn btn-primary" onclick="showScreen('progressScreen')">üìä PROGRESO</button>
                <button class="btn" onclick="showScreen('achievementsScreen')">üèÜ LOGROS</button>
            </div>
        </div>
    </div>

    <!-- ==================== CONFIGURACI√ìN DE PARTIDA ==================== -->
    <div id="gameConfig" class="screen">
        <div class="container">
            <h2 style="text-align: center; color: var(--color-warning); margin-bottom: 30px;">‚öôÔ∏è CONFIGURAR PARTIDA</h2>
            
            <div class="config-grid">
                <div class="config-section">
                    <h3>üìö Seleccionar Temario</h3>
                    <div class="form-group">
                        <label>Temario:</label>
                        <select id="selectedTemario" onchange="loadPuntosForGame()">
                            <option value="">-- Seleccionar --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Puntos a estudiar:</label>
                        <div id="puntosCheckboxes" style="max-height: 200px; overflow-y: auto;"></div>
                    </div>
                </div>

                <div class="config-section">
                    <h3>‚è±Ô∏è Modo de Juego</h3>
                    <div class="form-group">
                        <label>Modo:</label>
                        <select id="gameMode">
                            <option value="time">Por Tiempo</option>
                            <option value="money">Por Dinero</option>
                        </select>
                    </div>
                    <div class="form-group" id="timeModeConfig">
                        <label>Duraci√≥n (minutos):</label>
                        <input type="number" id="gameDuration" value="5" min="1" max="60">
                    </div>
                    <div class="form-group" id="moneyModeConfig" style="display: none;">
                        <label>Objetivo de dinero:</label>
                        <input type="number" id="moneyGoal" value="1000" min="100" step="100">
                    </div>
                </div>

                <div class="config-section">
                    <h3>ü§ñ Configuraci√≥n de Bots</h3>
                    <div class="form-group">
                        <label>N√∫mero de bots:</label>
                        <input type="number" id="numBots" value="3" min="0" max="5">
                    </div>
                    <div class="form-group">
                        <label>Dificultad:</label>
                        <select id="difficulty">
                            <option value="easy">F√°cil</option>
                            <option value="medium">Medio</option>
                            <option value="hard">Dif√≠cil</option>
                        </select>
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-success" onclick="startGame()">üéØ INICIAR PARTIDA</button>
                <button class="btn btn-danger" onclick="showScreen('mainMenu')">‚ùå CANCELAR</button>
            </div>
        </div>
    </div>

    <!-- ==================== PANTALLA DE JUEGO ==================== -->
    <div id="gameScreen" class="screen">
        <div class="game-area">
            <div class="game-header">
                <div class="player-stats">
                    <div class="stat-item">üí∞ <span id="playerMoney">0</span></div>
                    <div class="stat-item">üêü <span id="fishCaught">0</span></div>
                    <div class="stat-item">‚è±Ô∏è <span id="gameTimer">5:00</span></div>
                </div>
                <button class="btn btn-small btn-danger" onclick="endGame()">Terminar Partida</button>
            </div>

            <div class="fishing-canvas">
                <div class="fishing-rod">üé£</div>
                <div class="hook">ü™ù</div>
                <div style="text-align: center; padding-top: 180px;">
                    <button class="btn btn-warning" id="castButton" onclick="castHook()">üé£ LANZAR CA√ëA</button>
                </div>
            </div>

            <div class="bots-panel">
                <h3>ü§ñ Competidores:</h3>
                <div id="botsContainer"></div>
            </div>
        </div>
    </div>

    <!-- ==================== MODAL DE PREGUNTAS ==================== -->
    <div id="questionModal" class="modal">
        <div class="modal-content">
            <h3 style="color: var(--color-warning); margin-bottom: 20px;">‚ùì PREGUNTA</h3>
            <p class="question-text" id="questionText"></p>
            <div class="options" id="optionsContainer"></div>
        </div>
    </div>

    <!-- ==================== MODAL DE RESULTADO ==================== -->
    <div id="resultModal" class="modal">
        <div class="modal-content catch-result">
            <div id="resultContent"></div>
            <button class="btn btn-success" onclick="closeResultModal()" style="margin-top: 20px;">Continuar</button>
        </div>
    </div>

    <!-- ==================== PANTALLA DE RESULTADOS FINALES ==================== -->
    <div id="endGameScreen" class="screen">
        <div class="container">
            <h2 style="text-align: center; color: var(--color-warning); margin-bottom: 30px;">üèÅ FIN DE LA PARTIDA</h2>
            
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="finalMoney">0</div>
                    <div class="stat-label">üí∞ Dinero Total</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="finalFish">0</div>
                    <div class="stat-label">üêü Peces Pescados</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="finalChests">0</div>
                    <div class="stat-label">üì¶ Cofres Abiertos</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="finalCorrect">0</div>
                    <div class="stat-label">‚úÖ Respuestas Correctas</div>
                </div>
            </div>

            <h3 style="margin-top: 30px; color: var(--color-warning);">üèÜ RANKING FINAL</h3>
            <table class="ranking-table" id="finalRanking"></table>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-success" onclick="showScreen('mainMenu')">üè† MEN√ö PRINCIPAL</button>
                <button class="btn btn-primary" onclick="showScreen('gameConfig')">üîÑ NUEVA PARTIDA</button>
            </div>
        </div>
    </div>

    <!-- ==================== GESTI√ìN DE TEMARIOS ==================== -->
    <div id="temariosScreen" class="screen">
        <div class="container">
            <h2 style="text-align: center; color: var(--color-warning); margin-bottom: 30px;">üìö GESTI√ìN DE TEMARIOS</h2>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn btn-success" onclick="showCreateTemarioForm()">‚ûï NUEVO TEMARIO</button>
                <button class="btn btn-primary" onclick="exportTemarios()">üíæ EXPORTAR TODO</button>
                <button class="btn btn-warning" onclick="document.getElementById('importTemarios').click()">üìÅ IMPORTAR</button>
                <input type="file" id="importTemarios" accept=".json" style="display: none;" onchange="importTemarios(event)">
                <button class="btn btn-danger" onclick="showScreen('mainMenu')">üîô VOLVER</button>
            </div>

            <div id="createTemarioForm" style="display: none; background: #34495e; padding: 20px; border: 4px solid #000; margin-bottom: 20px;">
                <h3>Crear Nuevo Temario</h3>
                <div class="form-group">
                    <label>Nombre del Temario:</label>
                    <input type="text" id="newTemarioName">
                </div>
                <div class="form-group">
                    <label>Descripci√≥n:</label>
                    <textarea id="newTemarioDesc"></textarea>
                </div>
                <button class="btn btn-success" onclick="createTemario()">Crear</button>
                <button class="btn btn-danger" onclick="hideCreateTemarioForm()">Cancelar</button>
            </div>

            <div class="temarios-list" id="temariosList"></div>
        </div>
    </div>

    <!-- ==================== EDITOR DE PUNTOS ==================== -->
    <div id="puntosEditor" class="screen">
        <div class="container">
            <h2 style="text-align: center; color: var(--color-warning); margin-bottom: 30px;" id="editorTitle">EDITAR TEMARIO</h2>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn btn-success" onclick="showCreatePuntoForm()">‚ûï NUEVO PUNTO</button>
                <button class="btn btn-danger" onclick="backToTemarios()">üîô VOLVER</button>
            </div>

            <div id="createPuntoForm" style="display: none; background: #34495e; padding: 20px; border: 4px solid #000; margin-bottom: 20px;">
                <h3>Agregar Punto</h3>
                <div class="form-group">
                    <label>Nombre del Punto:</label>
                    <input type="text" id="newPuntoName">
                </div>
                <button class="btn btn-success" onclick="createPunto()">Agregar</button>
                <button class="btn btn-danger" onclick="hideCreatePuntoForm()">Cancelar</button>
            </div>

            <div id="puntosList"></div>
        </div>
    </div>

    <!-- ==================== EDITOR DE PREGUNTAS ==================== -->
    <div id="preguntasEditor" class="screen">
        <div class="container">
            <h2 style="text-align: center; color: var(--color-warning); margin-bottom: 30px;" id="preguntasTitle">EDITAR PREGUNTAS</h2>
            
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn btn-success" onclick="document.getElementById('importPreguntasJSON').click()">üìÅ IMPORTAR JSON</button>
                <button class="btn btn-warning" onclick="showPasteQuestionsForm()">üìã PEGAR PREGUNTAS</button>
                <button class="btn btn-primary" onclick="exportPreguntasJSON()">üíæ EXPORTAR JSON</button>
                <button class="btn" onclick="showJSONStructure()">‚ùì VER ESTRUCTURA JSON</button>
                <button class="btn btn-danger" onclick="backToPuntos()">üîô VOLVER</button>
                <input type="file" id="importPreguntasJSON" accept=".json" style="display: none;" onchange="importPreguntasJSON(event)">
            </div>

            <!-- Formulario para pegar preguntas -->
            <div id="pasteQuestionsForm" style="display: none; background: #34495e; padding: 20px; border: 4px solid #000; margin-bottom: 20px;">
                <h3>üìã Pegar Preguntas</h3>
                <p style="margin-bottom: 10px;">Pega tus preguntas en formato texto. Formatos aceptados:</p>
                <p style="font-size: 12px; color: var(--color-warning); margin-bottom: 15px;">
                    <strong>Opci√≥n m√∫ltiple:</strong> Pregunta? | A) opci√≥n1 | B) opci√≥n2 | C) opci√≥n3 | D) opci√≥n4 | Correcta: A<br>
                    <strong>Verdadero/Falso:</strong> Pregunta? | V/F | Correcta: V (o F)
                </p>
                <div class="form-group">
                    <label>Pega aqu√≠ tus preguntas (una por l√≠nea):</label>
                    <textarea id="pasteQuestionsText" rows="15" placeholder="Ejemplo:
¬øCu√°l es la capital de Francia? | A) Londres | B) Par√≠s | C) Madrid | D) Roma | Correcta: B
La Tierra es plana | V/F | Correcta: F"></textarea>
                </div>
                <button class="btn btn-success" onclick="processPastedQuestions()">‚úÖ IMPORTAR PREGUNTAS</button>
                <button class="btn btn-danger" onclick="hidePasteQuestionsForm()">‚ùå CANCELAR</button>
            </div>

            <!-- Modal para mostrar estructura JSON -->
            <div id="jsonStructureModal" class="modal">
                <div class="modal-content" style="max-width: 800px;">
                    <h3 style="color: var(--color-warning); margin-bottom: 20px;">üìñ ESTRUCTURA JSON PARA PREGUNTAS</h3>
                    <div style="background: #1a252f; padding: 20px; border: 2px solid #000; overflow-x: auto;">
                        <pre style="color: #2ecc71; font-size: 12px; margin: 0;">[
  {
    "tipo": "multiple",
    "texto": "¬øCu√°l es la capital de Francia?",
    "opciones": ["Londres", "Par√≠s", "Madrid", "Roma"],
    "correcta": 1
  },
  {
    "tipo": "truefalse",
    "texto": "La Tierra es plana",
    "correcta": false
  }
]</pre>
                    </div>
                    <p style="margin-top: 15px; font-size: 14px;">
                        <strong>Notas:</strong><br>
                        ‚Ä¢ <strong>tipo:</strong> "multiple" o "truefalse"<br>
                        ‚Ä¢ <strong>opciones:</strong> Array con 4 opciones (solo para "multiple")<br>
                        ‚Ä¢ <strong>correcta:</strong> √çndice 0-3 para "multiple", true/false para "truefalse"
                    </p>
                    <button class="btn btn-success" onclick="closeJSONStructureModal()">ENTENDIDO</button>
                </div>
            </div>

            <div id="preguntasList"></div>
        </div>
    </div>

    <!-- ==================== PROGRESO ==================== -->
    <div id="progressScreen" class="screen">
        <div class="container">
            <h2 style="text-align: center; color: var(--color-warning); margin-bottom: 30px;">üìä PROGRESO DEL JUGADOR</h2>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <button class="btn btn-success" onclick="saveProgress()">üíæ GUARDAR PROGRESO</button>
                <button class="btn btn-primary" onclick="document.getElementById('loadProgressFile').click()">üìÅ CARGAR PROGRESO</button>
                <input type="file" id="loadProgressFile" accept=".json" style="display: none;" onchange="loadProgress(event)">
                <button class="btn btn-danger" onclick="showScreen('mainMenu')">üîô VOLVER</button>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="totalMoney">0</div>
                    <div class="stat-label">üí∞ Dinero Total</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalFish">0</div>
                    <div class="stat-label">üêü Peces Totales</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalChests">0</div>
                    <div class="stat-label">üì¶ Cofres Totales</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalQuestions">0</div>
                    <div class="stat-label">‚úÖ Preguntas Correctas</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="totalGames">0</div>
                    <div class="stat-label">üéÆ Partidas Jugadas</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="winRate">0%</div>
                    <div class="stat-label">üèÜ Ratio de Victoria</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== LOGROS ==================== -->
    <div id="achievementsScreen" class="screen">
        <div class="container">
            <h2 style="text-align: center; color: var(--color-warning); margin-bottom: 30px;">üèÜ LOGROS</h2>
            
            <div style="text-align: center; margin-bottom: 30px;">
                <button class="btn btn-danger" onclick="showScreen('mainMenu')">üîô VOLVER</button>
            </div>

            <div class="achievements-grid" id="achievementsList"></div>
        </div>
    </div>

    <script>
        // ==================== DATOS GLOBALES ====================
        
        // Base de datos de temarios
        let temarios = [];
        
        // Estad√≠sticas del jugador
        let playerStats = {
            totalMoney: 0,
            totalFish: 0,
            totalChests: 0,
            totalCorrectAnswers: 0,
            totalGames: 0,
            gamesWon: 0,
            achievements: []
        };

        // Definici√≥n de logros
        const achievementDefinitions = [
            { id: 'first_fish', name: 'Primer Pez', icon: 'üêü', desc: 'Pesca tu primer pez', condition: () => playerStats.totalFish >= 1 },
            { id: 'fish_10', name: 'Pescador Novato', icon: 'üé£', desc: 'Pesca 10 peces', condition: () => playerStats.totalFish >= 10 },
            { id: 'fish_50', name: 'Pescador Experto', icon: 'üèÜ', desc: 'Pesca 50 peces', condition: () => playerStats.totalFish >= 50 },
            { id: 'fish_100', name: 'Maestro Pescador', icon: 'üëë', desc: 'Pesca 100 peces', condition: () => playerStats.totalFish >= 100 },
            { id: 'first_chest', name: 'Cazatesoros', icon: 'üì¶', desc: 'Abre tu primer cofre', condition: () => playerStats.totalChests >= 1 },
            { id: 'money_1000', name: 'Rico', icon: 'üí∞', desc: 'Acumula 1000 de dinero', condition: () => playerStats.totalMoney >= 1000 },
            { id: 'money_5000', name: 'Millonario', icon: 'üíé', desc: 'Acumula 5000 de dinero', condition: () => playerStats.totalMoney >= 5000 },
            { id: 'correct_100', name: 'Erudito', icon: 'üìö', desc: 'Responde 100 preguntas correctas', condition: () => playerStats.totalCorrectAnswers >= 100 },
            { id: 'first_win', name: 'Primera Victoria', icon: 'ü•á', desc: 'Gana tu primera partida', condition: () => playerStats.gamesWon >= 1 },
            { id: 'win_10', name: 'Imparable', icon: '‚≠ê', desc: 'Gana 10 partidas', condition: () => playerStats.gamesWon >= 10 }
        ];

        // Variables de juego activo
        let currentGame = {
            active: false,
            temario: null,
            selectedPuntos: [],
            questions: [],
            mode: 'time',
            duration: 300, // segundos
            moneyGoal: 1000,
            timer: null,
            timeRemaining: 0,
            player: {
                money: 0,
                fishCaught: 0,
                chestsOpened: 0,
                correctAnswers: 0
            },
            bots: [],
            currentQuestion: null
        };

        // Variables de edici√≥n
        let editingTemarioId = null;
        let editingPuntoId = null;

        // Tipos de peces con probabilidades y valores
        const fishTypes = [
            { name: 'Sardina', emoji: 'üêü', rarity: 'com√∫n', minValue: 10, maxValue: 30, weight: 50 },
            { name: 'Trucha', emoji: 'üê†', rarity: 'com√∫n', minValue: 20, maxValue: 50, weight: 30 },
            { name: 'Salm√≥n', emoji: 'üé£', rarity: 'poco com√∫n', minValue: 40, maxValue: 80, weight: 15 },
            { name: 'At√∫n', emoji: 'üê°', rarity: 'raro', minValue: 70, maxValue: 120, weight: 8 },
            { name: 'Pez Espada', emoji: 'üó°Ô∏è', rarity: '√©pico', minValue: 100, maxValue: 200, weight: 4 },
            { name: 'Tibur√≥n', emoji: 'ü¶à', rarity: 'legendario', minValue: 200, maxValue: 400, weight: 2 },
            { name: 'Ballena', emoji: 'üêã', rarity: 'm√≠tico', minValue: 400, maxValue: 800, weight: 1 }
        ];

        // Tipos de cofres
        const chestTypes = [
            { name: 'Cofre de Madera', emoji: 'üì¶', type: 'bonus', value: 50 },
            { name: 'Cofre de Plata', emoji: 'üíº', type: 'bonus', value: 100 },
            { name: 'Cofre de Oro', emoji: 'üéÅ', type: 'bonus', value: 200 },
            { name: 'Cofre Maldito', emoji: '‚ò†Ô∏è', type: 'penalty', value: -50 }
        ];

        // ==================== INICIALIZACI√ìN ====================
        
        window.onload = function() {
            loadFromLocalStorage();
            loadTemariosList();
            updateProgressScreen();
            updateAchievementsScreen();
            
            // Cambiar modo de juego
            document.getElementById('gameMode').addEventListener('change', function() {
                if (this.value === 'time') {
                    document.getElementById('timeModeConfig').style.display = 'block';
                    document.getElementById('moneyModeConfig').style.display = 'none';
                } else {
                    document.getElementById('timeModeConfig').style.display = 'none';
                    document.getElementById('moneyModeConfig').style.display = 'block';
                }
            });

            // Cargar temarios de ejemplo si no hay ninguno
            if (temarios.length === 0) {
                loadExampleTemarios();
            }
        };

        // ==================== GESTI√ìN DE PANTALLAS ====================
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');

            // Actualizar datos al mostrar ciertas pantallas
            if (screenId === 'temariosScreen') {
                loadTemariosList();
            } else if (screenId === 'progressScreen') {
                updateProgressScreen();
            } else if (screenId === 'achievementsScreen') {
                updateAchievementsScreen();
            } else if (screenId === 'gameConfig') {
                loadTemariosForGame();
            }
        }

        // ==================== NOTIFICACIONES ====================
        
        function showNotification(message, duration = 3000) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, duration);
        }

        // ==================== GESTI√ìN DE TEMARIOS ====================
        
        function showCreateTemarioForm() {
            document.getElementById('createTemarioForm').style.display = 'block';
        }

        function hideCreateTemarioForm() {
            document.getElementById('createTemarioForm').style.display = 'none';
            document.getElementById('newTemarioName').value = '';
            document.getElementById('newTemarioDesc').value = '';
        }

        function createTemario() {
            const name = document.getElementById('newTemarioName').value.trim();
            const desc = document.getElementById('newTemarioDesc').value.trim();

            if (!name) {
                alert('Por favor, ingresa un nombre para el temario');
                return;
            }

            const newTemario = {
                id: Date.now(),
                name: name,
                description: desc,
                puntos: []
            };

            temarios.push(newTemario);
            saveToLocalStorage();
            loadTemariosList();
            hideCreateTemarioForm();
            showNotification('‚úÖ Temario creado exitosamente');
        }

        function loadTemariosList() {
            const container = document.getElementById('temariosList');
            container.innerHTML = '';

            if (temarios.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px;">No hay temarios creados. ¬°Crea uno nuevo!</p>';
                return;
            }

            temarios.forEach(temario => {
                const card = document.createElement('div');
                card.className = 'temario-card';
                
                const totalPreguntas = temario.puntos.reduce((sum, punto) => sum + punto.preguntas.length, 0);
                
                card.innerHTML = `
                    <h3>${temario.name}</h3>
                    <p style="margin-bottom: 10px;">${temario.description || 'Sin descripci√≥n'}</p>
                    <p style="color: var(--color-warning);">üìù ${temario.puntos.length} puntos | ‚ùì ${totalPreguntas} preguntas</p>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-small btn-primary" onclick="editTemario(${temario.id})">‚úèÔ∏è Editar</button>
                        <button class="btn btn-small btn-warning" onclick="exportSingleTemario(${temario.id})">üíæ Exportar</button>
                        <button class="btn btn-small btn-danger" onclick="deleteTemario(${temario.id})">üóëÔ∏è Eliminar</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function editTemario(temarioId) {
            editingTemarioId = temarioId;
            const temario = temarios.find(t => t.id === temarioId);
            if (!temario) return;

            document.getElementById('editorTitle').textContent = `üìö EDITAR TEMARIO: ${temario.name}`;
            loadPuntosList();
            showScreen('puntosEditor');
        }

        function deleteTemario(temarioId) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar este temario? Esta acci√≥n no se puede deshacer.')) {
                return;
            }

            temarios = temarios.filter(t => t.id !== temarioId);
            saveToLocalStorage();
            loadTemariosList();
            showNotification('üóëÔ∏è Temario eliminado');
        }

        // ==================== GESTI√ìN DE PUNTOS ====================
        
        function showCreatePuntoForm() {
            document.getElementById('createPuntoForm').style.display = 'block';
        }

        function hideCreatePuntoForm() {
            document.getElementById('createPuntoForm').style.display = 'none';
            document.getElementById('newPuntoName').value = '';
        }

        function createPunto() {
            const name = document.getElementById('newPuntoName').value.trim();

            if (!name) {
                alert('Por favor, ingresa un nombre para el punto');
                return;
            }

            const temario = temarios.find(t => t.id === editingTemarioId);
            if (!temario) return;

            const newPunto = {
                id: Date.now(),
                name: name,
                preguntas: []
            };

            temario.puntos.push(newPunto);
            saveToLocalStorage();
            loadPuntosList();
            hideCreatePuntoForm();
            showNotification('‚úÖ Punto creado exitosamente');
        }

        function loadPuntosList() {
            const container = document.getElementById('puntosList');
            container.innerHTML = '';

            const temario = temarios.find(t => t.id === editingTemarioId);
            if (!temario) return;

            if (temario.puntos.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px;">No hay puntos creados. ¬°Crea uno nuevo!</p>';
                return;
            }

            temario.puntos.forEach(punto => {
                const card = document.createElement('div');
                card.className = 'temario-card';
                card.innerHTML = `
                    <h3>${punto.name}</h3>
                    <p style="color: var(--color-warning);">‚ùì ${punto.preguntas.length} preguntas</p>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-small btn-primary" onclick="editPunto(${punto.id})">‚úèÔ∏è Editar Preguntas</button>
                        <button class="btn btn-small btn-danger" onclick="deletePunto(${punto.id})">üóëÔ∏è Eliminar</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function editPunto(puntoId) {
            editingPuntoId = puntoId;
            const temario = temarios.find(t => t.id === editingTemarioId);
            if (!temario) return;

            const punto = temario.puntos.find(p => p.id === puntoId);
            if (!punto) return;

            document.getElementById('preguntasTitle').textContent = `‚ùì EDITAR PREGUNTAS: ${punto.name}`;
            loadPreguntasList();
            showScreen('preguntasEditor');
        }

        function deletePunto(puntoId) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar este punto? Esta acci√≥n no se puede deshacer.')) {
                return;
            }

            const temario = temarios.find(t => t.id === editingTemarioId);
            if (!temario) return;

            temario.puntos = temario.puntos.filter(p => p.id !== puntoId);
            saveToLocalStorage();
            loadPuntosList();
            showNotification('üóëÔ∏è Punto eliminado');
        }

        function backToTemarios() {
            editingTemarioId = null;
            showScreen('temariosScreen');
        }

        // ==================== GESTI√ìN DE PREGUNTAS ====================
        
        function showJSONStructure() {
            document.getElementById('jsonStructureModal').classList.add('active');
        }

        function closeJSONStructureModal() {
            document.getElementById('jsonStructureModal').classList.remove('active');
        }

        function showPasteQuestionsForm() {
            document.getElementById('pasteQuestionsForm').style.display = 'block';
        }

        function hidePasteQuestionsForm() {
            document.getElementById('pasteQuestionsForm').style.display = 'none';
            document.getElementById('pasteQuestionsText').value = '';
        }

        function importPreguntasJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const preguntas = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(preguntas)) {
                        throw new Error('El archivo debe contener un array de preguntas');
                    }

                    // Validar estructura de cada pregunta
                    for (const pregunta of preguntas) {
                        if (!pregunta.tipo || !pregunta.texto) {
                            throw new Error('Cada pregunta debe tener "tipo" y "texto"');
                        }
                        if (pregunta.tipo === 'multiple') {
                            if (!Array.isArray(pregunta.opciones) || pregunta.opciones.length !== 4) {
                                throw new Error('Las preguntas de opci√≥n m√∫ltiple deben tener exactamente 4 opciones');
                            }
                            if (typeof pregunta.correcta !== 'number' || pregunta.correcta < 0 || pregunta.correcta > 3) {
                                throw new Error('El √≠ndice de respuesta correcta debe ser 0, 1, 2 o 3');
                            }
                        } else if (pregunta.tipo === 'truefalse') {
                            if (typeof pregunta.correcta !== 'boolean') {
                                throw new Error('Las preguntas V/F deben tener correcta como true o false');
                            }
                        } else {
                            throw new Error('Tipo de pregunta inv√°lido: ' + pregunta.tipo);
                        }
                    }

                    // A√±adir preguntas al punto actual
                    const temario = temarios.find(t => t.id === editingTemarioId);
                    if (!temario) return;

                    const punto = temario.puntos.find(p => p.id === editingPuntoId);
                    if (!punto) return;

                    preguntas.forEach(pregunta => {
                        pregunta.id = Date.now() + Math.random();
                        punto.preguntas.push(pregunta);
                    });

                    saveToLocalStorage();
                    loadPreguntasList();
                    showNotification(`‚úÖ ${preguntas.length} preguntas importadas exitosamente`);
                } catch (error) {
                    alert('Error al importar preguntas: ' + error.message);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function exportPreguntasJSON() {
            const temario = temarios.find(t => t.id === editingTemarioId);
            if (!temario) return;

            const punto = temario.puntos.find(p => p.id === editingPuntoId);
            if (!punto) return;

            // Exportar preguntas sin IDs (para que sean m√°s limpias)
            const preguntasExport = punto.preguntas.map(p => {
                const { id, ...preguntaSinId } = p;
                return preguntaSinId;
            });

            const dataStr = JSON.stringify(preguntasExport, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `preguntas_${punto.name.replace(/\s+/g, '_')}.json`;
            link.click();
            showNotification('üíæ Preguntas exportadas exitosamente');
        }

        function processPastedQuestions() {
            const text = document.getElementById('pasteQuestionsText').value.trim();
            if (!text) {
                alert('Por favor, pega las preguntas');
                return;
            }

            const lines = text.split('\n').filter(line => line.trim());
            const preguntas = [];
            let errores = [];

            lines.forEach((line, index) => {
                try {
                    const parts = line.split('|').map(p => p.trim());
                    
                    if (parts.length < 3) {
                        throw new Error(`L√≠nea ${index + 1}: Formato incorrecto`);
                    }

                    const texto = parts[0];
                    
                    // Detectar si es V/F
                    if (parts[1].toUpperCase() === 'V/F' || parts[1].toUpperCase() === 'VF') {
                        // Pregunta Verdadero/Falso
                        const correctaPart = parts[2];
                        const correctaMatch = correctaPart.match(/Correcta:\s*(V|F|Verdadero|Falso|True|False)/i);
                        
                        if (!correctaMatch) {
                            throw new Error(`L√≠nea ${index + 1}: No se encontr√≥ respuesta correcta (V o F)`);
                        }

                        const correcta = correctaMatch[1].toUpperCase().startsWith('V') || 
                                       correctaMatch[1].toUpperCase().startsWith('T');

                        preguntas.push({
                            id: Date.now() + Math.random(),
                            tipo: 'truefalse',
                            texto: texto,
                            correcta: correcta
                        });
                    } else {
                        // Pregunta Opci√≥n M√∫ltiple
                        if (parts.length < 6) {
                            throw new Error(`L√≠nea ${index + 1}: Pregunta de opci√≥n m√∫ltiple incompleta (necesita 4 opciones + respuesta)`);
                        }

                        const opciones = [
                            parts[1].replace(/^[A-D]\)\s*/, ''),
                            parts[2].replace(/^[A-D]\)\s*/, ''),
                            parts[3].replace(/^[A-D]\)\s*/, ''),
                            parts[4].replace(/^[A-D]\)\s*/, '')
                        ];

                        const correctaPart = parts[5];
                        const correctaMatch = correctaPart.match(/Correcta:\s*([A-D])/i);
                        
                        if (!correctaMatch) {
                            throw new Error(`L√≠nea ${index + 1}: No se encontr√≥ respuesta correcta (A, B, C o D)`);
                        }

                        const correcta = correctaMatch[1].toUpperCase().charCodeAt(0) - 'A'.charCodeAt(0);

                        preguntas.push({
                            id: Date.now() + Math.random(),
                            tipo: 'multiple',
                            texto: texto,
                            opciones: opciones,
                            correcta: correcta
                        });
                    }
                } catch (error) {
                    errores.push(error.message);
                }
            });

            if (errores.length > 0) {
                alert('Errores encontrados:\n' + errores.join('\n'));
                return;
            }

            if (preguntas.length === 0) {
                alert('No se encontraron preguntas v√°lidas');
                return;
            }

            // A√±adir preguntas al punto actual
            const temario = temarios.find(t => t.id === editingTemarioId);
            if (!temario) return;

            const punto = temario.puntos.find(p => p.id === editingPuntoId);
            if (!punto) return;

            punto.preguntas.push(...preguntas);
            saveToLocalStorage();
            loadPreguntasList();
            hidePasteQuestionsForm();
            showNotification(`‚úÖ ${preguntas.length} preguntas importadas exitosamente`);
        }

        function loadPreguntasList() {
            const container = document.getElementById('preguntasList');
            container.innerHTML = '';

            const temario = temarios.find(t => t.id === editingTemarioId);
            if (!temario) return;

            const punto = temario.puntos.find(p => p.id === editingPuntoId);
            if (!punto) return;

            if (punto.preguntas.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 40px;">No hay preguntas creadas. ¬°Crea una nueva!</p>';
                return;
            }

            punto.preguntas.forEach((pregunta, index) => {
                const card = document.createElement('div');
                card.className = 'temario-card';
                
                let opcionesHTML = '';
                if (pregunta.tipo === 'multiple') {
                    opcionesHTML = `
                        <p style="margin-top: 10px;"><strong>Opciones:</strong></p>
                        <ul style="margin-left: 20px;">
                            ${pregunta.opciones.map((op, i) => `
                                <li style="${i === pregunta.correcta ? 'color: var(--color-success); font-weight: bold;' : ''}">${op}</li>
                            `).join('')}
                        </ul>
                    `;
                } else {
                    opcionesHTML = `<p style="margin-top: 10px; color: var(--color-success); font-weight: bold;">Respuesta: ${pregunta.correcta ? 'Verdadero' : 'Falso'}</p>`;
                }

                card.innerHTML = `
                    <h3>Pregunta ${index + 1} <span style="font-size: 14px; color: var(--color-warning);">(${pregunta.tipo === 'multiple' ? 'Opci√≥n M√∫ltiple' : 'Verdadero/Falso'})</span></h3>
                    <p style="margin: 10px 0;">${pregunta.texto}</p>
                    ${opcionesHTML}
                    <div style="margin-top: 15px;">
                        <button class="btn btn-small btn-danger" onclick="deletePregunta(${pregunta.id})">üóëÔ∏è Eliminar</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function deletePregunta(preguntaId) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar esta pregunta?')) {
                return;
            }

            const temario = temarios.find(t => t.id === editingTemarioId);
            if (!temario) return;

            const punto = temario.puntos.find(p => p.id === editingPuntoId);
            if (!punto) return;

            punto.preguntas = punto.preguntas.filter(p => p.id !== preguntaId);
            saveToLocalStorage();
            loadPreguntasList();
            showNotification('üóëÔ∏è Pregunta eliminada');
        }

        function backToPuntos() {
            editingPuntoId = null;
            showScreen('puntosEditor');
        }

        // ==================== IMPORTAR/EXPORTAR ====================
        
        function exportTemarios() {
            const dataStr = JSON.stringify(temarios, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'temarios_pesca_conocimiento.json';
            link.click();
            showNotification('üíæ Temarios exportados exitosamente');
        }

        function exportSingleTemario(temarioId) {
            const temario = temarios.find(t => t.id === temarioId);
            if (!temario) return;

            const dataStr = JSON.stringify([temario], null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `temario_${temario.name.replace(/\s+/g, '_')}.json`;
            link.click();
            showNotification('üíæ Temario exportado exitosamente');
        }

        function importTemarios(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (!Array.isArray(importedData)) {
                        throw new Error('Formato de archivo inv√°lido');
                    }

                    // Validar estructura
                    for (const temario of importedData) {
                        if (!temario.name || !Array.isArray(temario.puntos)) {
                            throw new Error('Estructura de temario inv√°lida');
                        }
                    }

                    // A√±adir temarios importados (con IDs nuevos para evitar conflictos)
                    importedData.forEach(temario => {
                        temario.id = Date.now() + Math.random();
                        temario.puntos.forEach(punto => {
                            punto.id = Date.now() + Math.random();
                            punto.preguntas.forEach(pregunta => {
                                pregunta.id = Date.now() + Math.random();
                            });
                        });
                        temarios.push(temario);
                    });

                    saveToLocalStorage();
                    loadTemariosList();
                    showNotification('‚úÖ Temarios importados exitosamente');
                } catch (error) {
                    alert('Error al importar: ' + error.message);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // ==================== CONFIGURACI√ìN DE PARTIDA ====================
        
        function loadTemariosForGame() {
            const select = document.getElementById('selectedTemario');
            select.innerHTML = '<option value="">-- Seleccionar --</option>';

            temarios.forEach(temario => {
                const option = document.createElement('option');
                option.value = temario.id;
                option.textContent = temario.name;
                select.appendChild(option);
            });
        }

        function loadPuntosForGame() {
            const temarioId = parseInt(document.getElementById('selectedTemario').value);
            const container = document.getElementById('puntosCheckboxes');
            container.innerHTML = '';

            if (!temarioId) return;

            const temario = temarios.find(t => t.id === temarioId);
            if (!temario) return;

            if (temario.puntos.length === 0) {
                container.innerHTML = '<p>Este temario no tiene puntos</p>';
                return;
            }

            const allCheckbox = document.createElement('div');
            allCheckbox.innerHTML = `
                <label style="display: flex; align-items: center; gap: 10px; padding: 5px;">
                    <input type="checkbox" id="puntoAll" onchange="toggleAllPuntos()">
                    <strong>Todos los puntos</strong>
                </label>
            `;
            container.appendChild(allCheckbox);

            temario.puntos.forEach(punto => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label style="display: flex; align-items: center; gap: 10px; padding: 5px;">
                        <input type="checkbox" class="punto-checkbox" value="${punto.id}">
                        ${punto.name} (${punto.preguntas.length} preguntas)
                    </label>
                `;
                container.appendChild(div);
            });
        }

        function toggleAllPuntos() {
            const allChecked = document.getElementById('puntoAll').checked;
            document.querySelectorAll('.punto-checkbox').forEach(cb => {
                cb.checked = allChecked;
            });
        }

        // ==================== INICIO DE PARTIDA ====================
        
        function startGame() {
            const temarioId = parseInt(document.getElementById('selectedTemario').value);
            if (!temarioId) {
                alert('Por favor, selecciona un temario');
                return;
            }

            const temario = temarios.find(t => t.id === temarioId);
            if (!temario) return;

            const selectedPuntos = Array.from(document.querySelectorAll('.punto-checkbox:checked'))
                .map(cb => parseInt(cb.value));

            if (selectedPuntos.length === 0) {
                alert('Por favor, selecciona al menos un punto');
                return;
            }

            // Recopilar todas las preguntas de los puntos seleccionados
            const questions = [];
            selectedPuntos.forEach(puntoId => {
                const punto = temario.puntos.find(p => p.id === puntoId);
                if (punto) {
                    questions.push(...punto.preguntas);
                }
            });

            if (questions.length === 0) {
                alert('Los puntos seleccionados no tienen preguntas');
                return;
            }

            // Configurar juego
            currentGame = {
                active: true,
                temario: temario,
                selectedPuntos: selectedPuntos,
                questions: questions,
                mode: document.getElementById('gameMode').value,
                duration: parseInt(document.getElementById('gameDuration').value) * 60,
                moneyGoal: parseInt(document.getElementById('moneyGoal').value),
                timer: null,
                timeRemaining: 0,
                player: {
                    money: 0,
                    fishCaught: 0,
                    chestsOpened: 0,
                    correctAnswers: 0
                },
                bots: [],
                currentQuestion: null
            };

            // Configurar tiempo
            if (currentGame.mode === 'time') {
                currentGame.timeRemaining = currentGame.duration;
            }

            // Crear bots
            const numBots = parseInt(document.getElementById('numBots').value);
            const difficulty = document.getElementById('difficulty').value;
            const botNames = ['RoboFish', 'NerdBot', 'PescaIA', 'CerebroBot', 'QuizMaster'];
            
            for (let i = 0; i < numBots; i++) {
                currentGame.bots.push({
                    name: botNames[i % botNames.length] + (i >= botNames.length ? i + 1 : ''),
                    money: 0,
                    fishCaught: 0,
                    difficulty: difficulty
                });
            }

            // Iniciar interfaz de juego
            updateGameUI();
            showScreen('gameScreen');

            // Iniciar timer si es modo tiempo
            if (currentGame.mode === 'time') {
                startGameTimer();
            }

            // Simular actividad de bots
            startBotsSimulation();
        }

        function updateGameUI() {
            document.getElementById('playerMoney').textContent = currentGame.player.money;
            document.getElementById('fishCaught').textContent = currentGame.player.fishCaught;
            
            if (currentGame.mode === 'time') {
                const minutes = Math.floor(currentGame.timeRemaining / 60);
                const seconds = currentGame.timeRemaining % 60;
                document.getElementById('gameTimer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            } else {
                document.getElementById('gameTimer').textContent = `${currentGame.player.money}/${currentGame.moneyGoal}`;
            }

            // Actualizar panel de bots
            const botsContainer = document.getElementById('botsContainer');
            botsContainer.innerHTML = '';
            currentGame.bots.forEach(bot => {
                const botDiv = document.createElement('div');
                botDiv.className = 'bot-item';
                botDiv.innerHTML = `
                    <span>ü§ñ ${bot.name}</span>
                    <span>üí∞ ${bot.money} | üêü ${bot.fishCaught}</span>
                `;
                botsContainer.appendChild(botDiv);
            });
        }

        function startGameTimer() {
            currentGame.timer = setInterval(() => {
                currentGame.timeRemaining--;
                updateGameUI();

                if (currentGame.timeRemaining <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function startBotsSimulation() {
            // Los bots pescan cada cierto tiempo
            setInterval(() => {
                if (!currentGame.active) return;

                currentGame.bots.forEach(bot => {
                    // Probabilidad basada en dificultad
                    let successChance = 0.3; // f√°cil
                    if (bot.difficulty === 'medium') successChance = 0.5;
                    if (bot.difficulty === 'hard') successChance = 0.7;

                    if (Math.random() < successChance) {
                        const fish = getRandomFish();
                        const value = Math.floor(Math.random() * (fish.maxValue - fish.minValue + 1)) + fish.minValue;
                        bot.money += value;
                        bot.fishCaught++;
                        updateGameUI();

                        // Verificar si el bot gan√≥
                        if (currentGame.mode === 'money' && bot.money >= currentGame.moneyGoal) {
                            endGame();
                        }
                    }
                });
            }, 5000); // Los bots intentan pescar cada 5 segundos
        }

        // ==================== MEC√ÅNICA DE PESCA ====================
        
        function castHook() {
            // Probabilidad de cofre (10%)
            if (Math.random() < 0.1) {
                const chest = chestTypes[Math.floor(Math.random() * chestTypes.length)];
                showChestResult(chest);
                return;
            }

            // Mostrar pregunta
            const question = getRandomQuestion();
            if (!question) {
                alert('No hay m√°s preguntas disponibles');
                return;
            }

            currentGame.currentQuestion = question;
            showQuestion(question);
        }

        function getRandomQuestion() {
            if (currentGame.questions.length === 0) return null;
            const index = Math.floor(Math.random() * currentGame.questions.length);
            return currentGame.questions[index];
        }

        function showQuestion(question) {
            document.getElementById('questionText').textContent = question.texto;
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            if (question.tipo === 'multiple') {
                question.opciones.forEach((opcion, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.textContent = opcion;
                    btn.onclick = () => checkAnswer(index);
                    optionsContainer.appendChild(btn);
                });
            } else {
                ['Verdadero', 'Falso'].forEach((opcion, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn';
                    btn.textContent = opcion;
                    btn.onclick = () => checkAnswer(index === 0);
                    optionsContainer.appendChild(btn);
                });
            }

            document.getElementById('questionModal').classList.add('active');
        }

        function checkAnswer(answer) {
            const question = currentGame.currentQuestion;
            const isCorrect = (question.correcta === answer);

            // Mostrar feedback visual
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach((btn, index) => {
                if (question.tipo === 'multiple') {
                    if (index === question.correcta) {
                        btn.classList.add('correct');
                    } else if (index === answer && !isCorrect) {
                        btn.classList.add('incorrect');
                    }
                } else {
                    if ((index === 0 && question.correcta === true) || (index === 1 && question.correcta === false)) {
                        btn.classList.add('correct');
                    } else if ((index === 0 && answer === true && !isCorrect) || (index === 1 && answer === false && !isCorrect)) {
                        btn.classList.add('incorrect');
                    }
                }
                btn.disabled = true;
            });

            setTimeout(() => {
                document.getElementById('questionModal').classList.remove('active');
                
                if (isCorrect) {
                    currentGame.player.correctAnswers++;
                    const fish = getRandomFish();
                    showFishResult(fish);
                } else {
                    showNotification('‚ùå Respuesta incorrecta. ¬°Int√©ntalo de nuevo!', 2000);
                }
            }, 1500);
        }

        function getRandomFish() {
            const totalWeight = fishTypes.reduce((sum, fish) => sum + fish.weight, 0);
            let random = Math.random() * totalWeight;

            for (const fish of fishTypes) {
                random -= fish.weight;
                if (random <= 0) {
                    return fish;
                }
            }

            return fishTypes[0];
        }

        function showFishResult(fish) {
            const value = Math.floor(Math.random() * (fish.maxValue - fish.minValue + 1)) + fish.minValue;
            currentGame.player.money += value;
            currentGame.player.fishCaught++;

            document.getElementById('resultContent').innerHTML = `
                <div class="fish-sprite">${fish.emoji}</div>
                <h3 style="color: var(--color-success);">¬°HAS PESCADO!</h3>
                <p style="font-size: 24px; margin: 10px 0;">${fish.name}</p>
                <p style="color: var(--color-warning);">Rareza: ${fish.rarity}</p>
                <p style="font-size: 20px; margin-top: 10px;">üí∞ +${value}</p>
            `;

            document.getElementById('resultModal').classList.add('active');
            updateGameUI();
            updateAchievements();

            // Verificar victoria por dinero
            if (currentGame.mode === 'money' && currentGame.player.money >= currentGame.moneyGoal) {
                setTimeout(() => {
                    closeResultModal();
                    endGame();
                }, 2000);
            }
        }

        function showChestResult(chest) {
            currentGame.player.chestsOpened++;
            currentGame.player.money += chest.value;

            document.getElementById('resultContent').innerHTML = `
                <div class="chest-sprite">${chest.emoji}</div>
                <h3 style="color: ${chest.type === 'bonus' ? 'var(--color-success)' : 'var(--color-danger)'};">
                    ${chest.type === 'bonus' ? '¬°COFRE ENCONTRADO!' : '¬°COFRE MALDITO!'}
                </h3>
                <p style="font-size: 24px; margin: 10px 0;">${chest.name}</p>
                <p style="font-size: 20px; margin-top: 10px;">
                    üí∞ ${chest.value > 0 ? '+' : ''}${chest.value}
                </p>
            `;

            document.getElementById('resultModal').classList.add('active');
            updateGameUI();
            updateAchievements();
        }

        function closeResultModal() {
            document.getElementById('resultModal').classList.remove('active');
        }

        // ==================== FIN DE PARTIDA ====================
        
        function endGame() {
            currentGame.active = false;
            if (currentGame.timer) {
                clearInterval(currentGame.timer);
            }

            // Actualizar estad√≠sticas del jugador
            playerStats.totalMoney += currentGame.player.money;
            playerStats.totalFish += currentGame.player.fishCaught;
            playerStats.totalChests += currentGame.player.chestsOpened;
            playerStats.totalCorrectAnswers += currentGame.player.correctAnswers;
            playerStats.totalGames++;

            // Crear ranking final
            const ranking = [
                { name: 'T√ö', money: currentGame.player.money, fish: currentGame.player.fishCaught, isPlayer: true },
                ...currentGame.bots.map(bot => ({ name: bot.name, money: bot.money, fish: bot.fishCaught, isPlayer: false }))
            ].sort((a, b) => b.money - a.money);

            // Verificar si el jugador gan√≥
            if (ranking[0].isPlayer) {
                playerStats.gamesWon++;
                showNotification('üèÜ ¬°FELICIDADES! ¬°HAS GANADO!', 5000);
            }

            // Mostrar estad√≠sticas finales
            document.getElementById('finalMoney').textContent = currentGame.player.money;
            document.getElementById('finalFish').textContent = currentGame.player.fishCaught;
            document.getElementById('finalChests').textContent = currentGame.player.chestsOpened;
            document.getElementById('finalCorrect').textContent = currentGame.player.correctAnswers;

            // Mostrar ranking
            const rankingTable = document.getElementById('finalRanking');
            rankingTable.innerHTML = `
                <thead>
                    <tr>
                        <th>Posici√≥n</th>
                        <th>Nombre</th>
                        <th>üí∞ Dinero</th>
                        <th>üêü Peces</th>
                    </tr>
                </thead>
                <tbody>
                    ${ranking.map((player, index) => `
                        <tr class="${index < 3 ? 'rank-' + (index + 1) : ''}">
                            <td>${index + 1}</td>
                            <td><strong>${player.name}</strong></td>
                            <td>${player.money}</td>
                            <td>${player.fish}</td>
                        </tr>
                    `).join('')}
                </tbody>
            `;

            saveToLocalStorage();
            updateAchievements();
            showScreen('endGameScreen');
        }

        // ==================== LOGROS ====================
        
        function updateAchievements() {
            achievementDefinitions.forEach(achievement => {
                if (!playerStats.achievements.includes(achievement.id) && achievement.condition()) {
                    playerStats.achievements.push(achievement.id);
                    showNotification(`üèÜ ¬°Logro desbloqueado: ${achievement.name}!`, 5000);
                    saveToLocalStorage();
                }
            });
        }

        function updateAchievementsScreen() {
            const container = document.getElementById('achievementsList');
            container.innerHTML = '';

            achievementDefinitions.forEach(achievement => {
                const unlocked = playerStats.achievements.includes(achievement.id);
                const div = document.createElement('div');
                div.className = 'achievement' + (unlocked ? ' unlocked' : '');
                div.innerHTML = `
                    <div class="achievement-icon">${unlocked ? achievement.icon : 'üîí'}</div>
                    <div style="font-size: 14px; font-weight: bold;">${achievement.name}</div>
                    <div style="font-size: 12px; margin-top: 5px;">${achievement.desc}</div>
                `;
                container.appendChild(div);
            });
        }

        // ==================== PROGRESO ====================
        
        function updateProgressScreen() {
            document.getElementById('totalMoney').textContent = playerStats.totalMoney;
            document.getElementById('totalFish').textContent = playerStats.totalFish;
            document.getElementById('totalChests').textContent = playerStats.totalChests;
            document.getElementById('totalQuestions').textContent = playerStats.totalCorrectAnswers;
            document.getElementById('totalGames').textContent = playerStats.totalGames;
            
            const winRate = playerStats.totalGames > 0 
                ? Math.round((playerStats.gamesWon / playerStats.totalGames) * 100) 
                : 0;
            document.getElementById('winRate').textContent = winRate + '%';
        }

        function saveProgress() {
            const progressData = {
                version: '1.0',
                timestamp: new Date().toISOString(),
                temarios: temarios,
                playerStats: playerStats
            };

            const dataStr = JSON.stringify(progressData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'progreso_pesca_conocimiento.json';
            link.click();
            showNotification('üíæ Progreso guardado exitosamente');
        }

        function loadProgress(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!data.version || !data.temarios || !data.playerStats) {
                        throw new Error('Formato de archivo inv√°lido');
                    }

                    temarios = data.temarios;
                    playerStats = data.playerStats;

                    saveToLocalStorage();
                    updateProgressScreen();
                    updateAchievementsScreen();
                    loadTemariosList();
                    showNotification('‚úÖ Progreso cargado exitosamente');
                } catch (error) {
                    alert('Error al cargar progreso: ' + error.message);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // ==================== ALMACENAMIENTO LOCAL ====================
        
        function saveToLocalStorage() {
            localStorage.setItem('pesca_temarios', JSON.stringify(temarios));
            localStorage.setItem('pesca_stats', JSON.stringify(playerStats));
        }

        function loadFromLocalStorage() {
            const savedTemarios = localStorage.getItem('pesca_temarios');
            const savedStats = localStorage.getItem('pesca_stats');

            if (savedTemarios) {
                try {
                    temarios = JSON.parse(savedTemarios);
                } catch (e) {
                    console.error('Error al cargar temarios:', e);
                }
            }

            if (savedStats) {
                try {
                    playerStats = JSON.parse(savedStats);
                } catch (e) {
                    console.error('Error al cargar estad√≠sticas:', e);
                }
            }
        }

        // ==================== DATOS DE EJEMPLO ====================
        
        function loadExampleTemarios() {
            temarios = [
                {
                    id: 1,
                    name: "Historia Universal",
                    description: "Temario b√°sico de historia mundial",
                    puntos: [
                        {
                            id: 11,
                            name: "Edad Antigua",
                            preguntas: [
                                {
                                    id: 111,
                                    tipo: "multiple",
                                    texto: "¬øEn qu√© a√±o cay√≥ el Imperio Romano de Occidente?",
                                    opciones: ["476 d.C.", "410 d.C.", "500 d.C.", "395 d.C."],
                                    correcta: 0
                                },
                                {
                                    id: 112,
                                    tipo: "truefalse",
                                    texto: "Cleopatra fue la √∫ltima reina del Antiguo Egipto",
                                    correcta: true
                                },
                                {
                                    id: 113,
                                    tipo: "multiple",
                                    texto: "¬øQui√©n fue el primer emperador de Roma?",
                                    opciones: ["Julio C√©sar", "Augusto", "Ner√≥n", "Trajano"],
                                    correcta: 1
                                },
                                {
                                    id: 114,
                                    tipo: "truefalse",
                                    texto: "Las pir√°mides de Giza fueron construidas por esclavos",
                                    correcta: false
                                }
                            ]
                        },
                        {
                            id: 12,
                            name: "Edad Media",
                            preguntas: [
                                {
                                    id: 121,
                                    tipo: "multiple",
                                    texto: "¬øEn qu√© a√±o comenzaron las Cruzadas?",
                                    opciones: ["1066", "1095", "1215", "1348"],
                                    correcta: 1
                                },
                                {
                                    id: 122,
                                    tipo: "truefalse",
                                    texto: "La peste negra mat√≥ aproximadamente a un tercio de la poblaci√≥n europea",
                                    correcta: true
                                },
                                {
                                    id: 123,
                                    tipo: "multiple",
                                    texto: "¬øQui√©n escribi√≥ 'La Divina Comedia'?",
                                    opciones: ["Petrarca", "Boccaccio", "Dante Alighieri", "Chaucer"],
                                    correcta: 2
                                }
                            ]
                        }
                    ]
                },
                {
                    id: 2,
                    name: "Ciencias Naturales",
                    description: "Conocimientos b√°sicos de biolog√≠a y qu√≠mica",
                    puntos: [
                        {
                            id: 21,
                            name: "Biolog√≠a Celular",
                            preguntas: [
                                {
                                    id: 211,
                                    tipo: "multiple",
                                    texto: "¬øCu√°l es la funci√≥n principal de las mitocondrias?",
                                    opciones: ["S√≠ntesis de prote√≠nas", "Producci√≥n de energ√≠a", "Fotos√≠ntesis", "Digesti√≥n celular"],
                                    correcta: 1
                                },
                                {
                                    id: 212,
                                    tipo: "truefalse",
                                    texto: "Las c√©lulas vegetales tienen pared celular pero las animales no",
                                    correcta: true
                                },
                                {
                                    id: 213,
                                    tipo: "multiple",
                                    texto: "¬øQu√© org√°nulo contiene el material gen√©tico?",
                                    opciones: ["N√∫cleo", "Ret√≠culo endoplasm√°tico", "Aparato de Golgi", "Lisosoma"],
                                    correcta: 0
                                }
                            ]
                        },
                        {
                            id: 22,
                            name: "Qu√≠mica B√°sica",
                            preguntas: [
                                {
                                    id: 221,
                                    tipo: "truefalse",
                                    texto: "El agua est√° compuesta por dos √°tomos de hidr√≥geno y uno de ox√≠geno",
                                    correcta: true
                                },
                                {
                                    id: 222,
                                    tipo: "multiple",
                                    texto: "¬øCu√°l es el s√≠mbolo qu√≠mico del oro?",
                                    opciones: ["Go", "Au", "Ag", "Or"],
                                    correcta: 1
                                },
                                {
                                    id: 223,
                                    tipo: "multiple",
                                    texto: "¬øQu√© tipo de enlace se forma cuando se comparten electrones?",
                                    opciones: ["I√≥nico", "Met√°lico", "Covalente", "Van der Waals"],
                                    correcta: 2
                                }
                            ]
                        }
                    ]
                }
            ];

            saveToLocalStorage();
            showNotification('‚úÖ Temarios de ejemplo cargados');
        }
    </script>
</body>
</html>
